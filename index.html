<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Escape Game : Acad√©mie des Arcanes</title>
  <style>
    body {
      margin: 0;
      font-family: "Cinzel", serif;
      background: url('images/decor-magique.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #f5f5f5;
      text-align: center;
      overflow-x: hidden;
    }
    #intro, #game, #end { display: none; padding: 20px; }
    .enigme {
      margin: 20px auto;
      padding: 15px;
      width: 60%;
      background: rgba(0,0,0,0.6);
      border: 2px solid gold;
      border-radius: 10px;
      text-align: left;
      position: relative;
      transition: box-shadow 0.3s ease;
    }
    .indiceTexte {
      margin-top: 10px;
      color: #ffd700;
      font-style: italic;
      display: none;
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    .indiceTexte.show { display: block; opacity: 1; transform: translateY(0); }
    .highlight { box-shadow: 0 0 20px 5px gold; }
    input { margin-top: 5px; padding: 5px; }
    .bonus { position: absolute; width: 40px; cursor: pointer; transition: transform 0.2s; }
    .bonus:hover { transform: scale(1.2); }
    #inventaire {
      position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.7); border: 2px solid gold;
      border-top-left-radius: 10px; border-top-right-radius: 10px;
      padding: 10px; width: 250px; text-align: center; cursor: pointer; z-index: 2000;
    }
    #contenuInventaire { display: none; margin-top: 10px; display: flex; justify-content: center; gap: 10px; }
    #contenuInventaire img { width: 35px; cursor: default; }
    #popupIndice {
      display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
      background:rgba(20,20,20,0.95); padding:20px; border:3px solid gold; border-radius:10px;
      z-index:1000; width:50%; text-align:center;
    }
  </style>
</head>
<body>

<div id="intro">
  <h1>üåë Acad√©mie des Arcanes üåë</h1>
  <p>Une ombre mal√©fique plane sur l'acad√©mie... Le grimoire ancien a disparu !</p>
  <button onclick="startGame()">üéµ Commencer l‚Äôaventure üéµ</button>
</div>

<div id="game">
  <h2>R√©solvez les √©nigmes avant la fin du sablier ‚è≥</h2>
  <div id="timer">Temps restant : 1:00:00</div>

  <div class="enigme" data-indice="La couleur est VIOLET" data-indice-affiche="false">
    <h3>√ânigme 1 : Potion de Couleurs</h3>
    <p>M√©lange rouge et bleu, quelle couleur appara√Æt ?</p>
    <input type="text" id="rep1">
    <div class="indiceTexte"></div>
  </div>

  <div class="enigme" data-indice="Le mot magique est SORT" data-indice-affiche="false">
    <h3>√ânigme 2 : Parchemin cod√©</h3>
    <p>D√©cale chaque lettre de 3 : KRODFR</p>
    <input type="text" id="rep2">
    <div class="indiceTexte"></div>
  </div>

  <button onclick="verifier()">V√©rifier les r√©ponses</button>
</div>

<div id="end"></div>

<!-- Bonus cach√©s -->
<img src="images/bonus-fiole.png" class="bonus" style="top:80%; left:15%;" onclick="trouverBonus(this, 'fiole')">
<img src="images/bonus-etoile.png" class="bonus" style="top:40%; left:70%;" onclick="trouverBonus(this, 'etoile')">
<img src="images/bonus-grimoire.jpg" class="bonus" style="top:60%; left:40%;" onclick="trouverBonus(this, 'grimoire')">

<div id="inventaire" onclick="toggleInventaire()">
  üì¶ Inventaire magique
  <div id="contenuInventaire"></div>
</div>

<!-- Popup indice -->
<div id="popupIndice">
  <p id="popupMessage">Voulez-vous un indice ?</p>
  <button id="btnOui">Oui</button>
  <button id="btnNon">Non</button>
</div>

<!-- Sons -->
<audio id="musiqueIntro" src="sons/intro.mp3"></audio>
<audio id="musiqueAmbiance" src="sons/ambiance.mp3" loop></audio>
<audio id="musiqueVictoire" src="sons/victoire.mp3"></audio>
<audio id="musiqueDefaite" src="sons/defaite.mp3"></audio>
<audio id="sonBonus" src="sons/bonus.mp3"></audio>
<audio id="sonIndiceMagique" src="sons/scintillement.mp3"></audio>
<audio id="sonFiole" src="sons/fiole.mp3"></audio>
<audio id="sonEtoile" src="sons/etoile.mp3"></audio>
<audio id="sonGrimoire" src="sons/grimoire.mp3"></audio>

<script>
let tempsRestant = 3600;
let timerInterval;
let inventaire = [];
let indiceActuelEnigme = null;

document.getElementById("intro").style.display = "block";

function startGame() {
  document.getElementById("intro").style.display = "none";
  document.getElementById("game").style.display = "block";

  document.getElementById("musiqueIntro").play();
  setTimeout(() => {
    document.getElementById("musiqueIntro").pause();
    document.getElementById("musiqueAmbiance").play();
  }, 5000);

  timerInterval = setInterval(updateTimer, 1000);
  setInterval(proposerIndiceAleatoire, 30000);
}

function updateTimer() {
  tempsRestant--;
  let heures = Math.floor(tempsRestant / 3600);
  let minutes = Math.floor((tempsRestant % 3600) / 60);
  let secondes = tempsRestant % 60;
  document.getElementById("timer").innerText = 
    `Temps restant : ${heures}:${minutes.toString().padStart(2,'0')}:${secondes.toString().padStart(2,'0')}`;
  if (tempsRestant <= 0) { clearInterval(timerInterval); finPerdue(); }
}

function verifier() {
  let r1 = document.getElementById("rep1").value.trim().toLowerCase();
  let r2 = document.getElementById("rep2").value.trim().toLowerCase();
  if (r1 === "violet" && r2 === "sort") finGagnee();
  else alert("Ce n‚Äôest pas encore la bonne r√©ponse...");
}

// INDICES
function proposerIndiceAleatoire() {
  let enigmes = Array.from(document.querySelectorAll(".enigme"))
                      .filter(e => e.dataset.indiceAffiche === "false");
  if (enigmes.length === 0) return;
  indiceActuelEnigme = enigmes[Math.floor(Math.random() * enigmes.length)];
  document.getElementById("popupIndice").style.display = "block";
}

document.getElementById("btnOui").onclick = () => {
  let indiceDiv = indiceActuelEnigme.querySelector(".indiceTexte");
  indiceDiv.innerText = indiceActuelEnigme.dataset.indice;
  indiceDiv.classList.add("show");
  indiceActuelEnigme.classList.add("highlight");
  setTimeout(() => indiceActuelEnigme.classList.remove("highlight"), 2000);
  document.getElementById("sonIndiceMagique").play();
  indiceActuelEnigme.dataset.indiceAffiche = "true";
  document.getElementById("popupIndice").style.display = "none";
}

document.getElementById("btnNon").onclick = () => {
  indiceActuelEnigme.dataset.indiceAffiche = "true";
  document.getElementById("popupIndice").style.display = "none";
}

// BONUS
function trouverBonus(element, type) {
  element.onclick = null;
  element.style.display = "none";

  if (type === "fiole") document.getElementById("sonFiole").play();
  else if (type === "etoile") document.getElementById("sonEtoile").play();
  else if (type === "grimoire") document.getElementById("sonGrimoire").play();

  let message = "";
  if (type === "fiole") { tempsRestant += 120; message = "‚è≥ +2 minutes !"; }
  else if (type === "etoile") { message = "‚ú® Indice secret : 'Cherchez √† la lumi√®re...'"; }
  else if (type === "grimoire") { message = "üìñ Grimoire ancien trouv√© !"; }

  inventaire.push(type);
  let invDiv = document.getElementById("contenuInventaire");
  let img = document.createElement("img");
  img.src = "images/bonus-" + type + ".png";
  img.title = message;
  invDiv.appendChild(img);
}

// INVENTAIRE
function toggleInventaire() {
  let contenu = document.getElementById("contenuInventaire");
  contenu.style.display = contenu.style.display === "none" ? "flex" : "none";
}

// FINS
function finGagnee() {
  clearInterval(timerInterval);
  document.getElementById("game").style.display = "none";
  document.getElementById("end").style.display = "block";
  document.getElementById("end").innerHTML = "<h1>‚ú® Victoire ! ‚ú®</h1><p>Vous avez sauv√© l'acad√©mie !</p>";
  document.getElementById("musiqueAmbiance").pause();
  document.getElementById("musiqueVictoire").play();
}
function finPerdue() {
  document.getElementById("game").style.display = "none";
  document.getElementById("end").style.display = "block";
  document.getElementById("end").innerHTML = "<h1>‚ò† D√©faite... ‚ò†</h1><p>La magie noire a englouti l'acad√©mie.</p>";
  document.getElementById("musiqueAmbiance").pause();
  document.getElementById("musiqueDefaite").play();
}
</script>
</body>
</html>
