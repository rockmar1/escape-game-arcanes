<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Escape Game : Acad√©mie des Arcanes</title>
  <style>
    body {
      margin: 0;
      font-family: "Cinzel", serif;
      background: url('decor-magique.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #f5f5f5;
      text-align: center;
      overflow-x: hidden;
    }
    #intro, #game, #end {
      display: none;
      padding: 20px;
    }
    .enigme {
      margin: 20px auto;
      padding: 15px;
      width: 60%;
      background: rgba(0,0,0,0.6);
      border: 2px solid gold;
      border-radius: 10px;
      text-align: left;
    }
    input {
      margin-top: 5px;
      padding: 5px;
    }
    #popupIndice, #popupBonus {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(20, 20, 20, 0.95);
      padding: 20px;
      border: 3px solid gold;
      border-radius: 10px;
      z-index: 1000;
      width: 50%;
      text-align: center;
    }
    #popupIndice button, #popupBonus button {
      margin: 10px;
      padding: 8px 15px;
      cursor: pointer;
    }

    /* BONUS CACH√âS */
    .bonus {
      position: absolute;
      width: 40px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .bonus:hover {
      transform: scale(1.2);
    }

    /* INVENTAIRE */
    #inventaire {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      border: 2px solid gold;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      padding: 10px;
      width: 250px;
      text-align: center;
      cursor: pointer;
      z-index: 2000;
    }
    #contenuInventaire {
      display: none;
      margin-top: 10px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    #contenuInventaire img {
      width: 35px;
    }
  </style>
</head>
<body>

  <!-- INTRO -->
  <div id="intro">
    <h1>üåë Acad√©mie des Arcanes üåë</h1>
    <p>Une ombre mal√©fique plane sur l'acad√©mie... Le grimoire ancien a disparu !</p>
    <button onclick="startGame()">üéµ Commencer l‚Äôaventure üéµ</button>
  </div>

  <!-- JEU -->
  <div id="game">
    <h2>R√©solvez les √©nigmes avant la fin du sablier ‚è≥</h2>
    <div id="timer">Temps restant : 60:00</div>

    <div class="enigme" data-indice="La couleur est VIOLET">
      <h3>√ânigme 1 : Potion de Couleurs</h3>
      <p>M√©lange rouge et bleu, quelle couleur appara√Æt ?</p>
      <input type="text" id="rep1">
    </div>

    <div class="enigme" data-indice="Le mot magique est SORT">
      <h3>√ânigme 2 : Parchemin cod√©</h3>
      <p>D√©cale chaque lettre de 3 : KRODFR</p>
      <input type="text" id="rep2">
    </div>

    <button onclick="verifier()">V√©rifier les r√©ponses</button>
  </div>

  <!-- FIN -->
  <div id="end"></div>

  <!-- POPUP INDICE -->
  <div id="popupIndice">
    <p id="popupMessage"></p>
    <button onclick="revealIndice()">Oui</button>
    <button onclick="closePopup()">Non</button>
  </div>

  <!-- POPUP BONUS -->
  <div id="popupBonus">
    <p id="bonusMessage"></p>
    <button onclick="closeBonus()">Fermer</button>
  </div>

  <!-- BONUS CACH√âS -->
  <img src="bonus-fiole.png" class="bonus" style="top:80%; left:15%;" onclick="trouverBonus(this, 'fiole')">
  <img src="bonus-etoile.png" class="bonus" style="top:40%; left:70%;" onclick="trouverBonus(this, 'etoile')">
  <img src="bonus-grimoire.png" class="bonus" style="top:60%; left:40%;" onclick="trouverBonus(this, 'grimoire')">

  <!-- INVENTAIRE -->
  <div id="inventaire" onclick="toggleInventaire()">
    üì¶ Inventaire magique
    <div id="contenuInventaire"></div>
  </div>

  <!-- MUSIQUES -->
  <audio id="musiqueIntro" src="sons/intro.mp3"></audio>
  <audio id="musiqueAmbiance" src="sons/ambiance.mp3" loop></audio>
  <audio id="musiqueVictoire" src="sons/victoire.mp3"></audio>
  <audio id="musiqueDefaite" src="sons/defaite.mp3"></audio>
  <audio id="sonIndice" src="sons/indice.mp3"></audio>
  <audio id="sonBonus" src="sons/bonus.mp3"></audio>

  <script>
    let tempsRestant = 3600; // 1h
    let timerInterval;
    let indiceActuel = null;
    let inventaire = [];

    document.getElementById("intro").style.display = "block";

    function startGame() {
      document.getElementById("intro").style.display = "none";
      document.getElementById("game").style.display = "block";
      
      document.getElementById("musiqueIntro").play();
      setTimeout(() => {
        document.getElementById("musiqueIntro").pause();
        document.getElementById("musiqueAmbiance").play();
      }, 5000);

      timerInterval = setInterval(updateTimer, 1000);
      setTimeout(popupIndiceAleatoire, Math.random()*20000 + 10000); // premier indice
    }

    function updateTimer() {
      tempsRestant--;
      let minutes = Math.floor(tempsRestant/60);
      let secondes = tempsRestant%60;
      document.getElementById("timer").innerText = 
        `Temps restant : ${minutes}:${secondes.toString().padStart(2,'0')}`;
      
      if (tempsRestant <= 0) {
        clearInterval(timerInterval);
        finPerdue();
      }
    }

    function verifier() {
      let r1 = document.getElementById("rep1").value.toLowerCase();
      let r2 = document.getElementById("rep2").value.toLowerCase();

      if (r1 === "violet" && r2 === "sort") {
        finGagnee();
      } else {
        alert("Ce n‚Äôest pas encore la bonne r√©ponse...");
      }
    }

    // POPUP INDICE
    function popupIndiceAleatoire() {
      let enigmes = document.querySelectorAll(".enigme");
      let randomEnigme = enigmes[Math.floor(Math.random()*enigmes.length)];
      indiceActuel = randomEnigme.getAttribute("data-indice");

      document.getElementById("popupMessage").innerText = "Voulez-vous un indice ?";
      document.getElementById("popupIndice").style.display = "block";
    }

    function revealIndice() {
      document.getElementById("popupMessage").innerText = indiceActuel;
      document.getElementById("sonIndice").play();
    }

    function closePopup() {
      document.getElementById("popupIndice").style.display = "none";
    }

    // BONUS CACH√âS + INVENTAIRE
    function trouverBonus(element, type) {
      document.getElementById("sonBonus").play();

      let message = "";
      if (type === "fiole") {
        tempsRestant += 120; // +2 min
        message = "‚è≥ Vous avez gagn√© 2 minutes suppl√©mentaires !";
      } else if (type === "etoile") {
        message = "‚ú® Un indice secret vous est murmur√© : 'Cherchez √† la lumi√®re...'";
      } else if (type === "grimoire") {
        message = "üìñ Vous trouvez un grimoire ancien rempli de formules !";
      }

      // Ajout dans inventaire
      inventaire.push(type);
      let invDiv = document.getElementById("contenuInventaire");
      let img = document.createElement("img");
      img.src = "bonus-" + type + ".png";
      invDiv.appendChild(img);

      // Retire le bonus du d√©cor
      element.style.display = "none";

      // Affiche le popup
      document.getElementById("bonusMessage").innerText = message;
      document.getElementById("popupBonus").style.display = "block";
    }

    function closeBonus() {
      document.getElementById("popupBonus").style.display = "none";
    }

    // INVENTAIRE
    function toggleInventaire() {
      let contenu = document.getElementById("contenuInventaire");
      contenu.style.display = contenu.style.display === "none" ? "flex" : "none";
    }

    // FINS
    function finGagnee() {
      clearInterval(timerInterval);
      document.getElementById("game").style.display = "none";
      document.getElementById("end").style.display = "block";
      document.getElementById("end").innerHTML = "<h1>‚ú® Victoire ! ‚ú®</h1><p>Vous avez sauv√© l'acad√©mie !</p>";
      document.getElementById("musiqueAmbiance").pause();
      document.getElementById("musiqueVictoire").play();
    }

    function finPerdue() {
      document.getElementById("game").style.display = "none";
      document.getElementById("end").style.display = "block";
      document.getElementById("end").innerHTML = "<h1>‚ò† D√©faite... ‚ò†</h1><p>La magie noire a englouti l'acad√©mie.</p>";
      document.getElementById("musiqueAmbiance").pause();
      document.getElementById("musiqueDefaite").play();
    }
  </script>
</body>
</html>
