<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Escape Game Magique</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Uncial+Antiqua&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Uncial Antiqua', cursive;
      background: url('https://www.transparenttextures.com/patterns/parchment.png');
      color: #f5f5dc;
      text-shadow: 1px 1px 3px #000;
      margin: 0;
      padding: 0;
    }
    #intro, #game, #overlay {
      max-width: 900px;
      margin: auto;
      padding: 30px;
    }
    #intro {
      background: rgba(0,0,0,0.85);
      margin-top: 60px;
      border-radius: 15px;
      box-shadow: 0 0 40px #6f42c1;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    #intro h1 {
      font-family: 'Cinzel', serif;
      font-size: 2.5em;
      margin-bottom: 20px;
      color: #ffd700;
      text-shadow: 2px 2px 8px black;
    }
    #introText {
      font-size: 1.2em;
      line-height: 1.6em;
      text-align: justify;
      display: inline-block;
      white-space: pre-wrap;
      border-left: 3px solid #ffd700;
      padding-left: 15px;
    }
    #startBtn {
      display: none;
      padding: 12px 25px;
      margin-top: 25px;
      background: #6f42c1;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Cinzel', serif;
      font-size: 1.3em;
      box-shadow: 0 0 15px #000;
      animation: pulse 1.5s infinite;
    }
    #startBtn:hover {
      background: #ffd700;
      color: black;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 10px #6f42c1; }
      50% { box-shadow: 0 0 25px #ffd700; }
      100% { box-shadow: 0 0 10px #6f42c1; }
    }
    #grimoire {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 120%;
      height: 120%;
      background: radial-gradient(circle at center, rgba(255,215,0,0.15), rgba(0,0,0,0.9));
      border-radius: 50%;
      animation: aura 5s infinite alternate;
      z-index: -1;
    }
    @keyframes aura {
      from { opacity: 0.6; transform: translateX(-50%) scale(1); }
      to { opacity: 0.9; transform: translateX(-50%) scale(1.05); }
    }
    #timer { font-size: 1.5em; margin: 20px 0; }
    .enigme { margin: 20px 0; padding: 15px; border: 2px solid #ffd700; border-radius: 10px; }
    input[type=text] { width: 60%; padding: 8px; margin-top: 10px; }
    button { margin-top: 10px; padding: 8px 15px; font-family: 'Cinzel', serif; cursor: pointer; }
    #overlay {
      display:none;
      text-align:center;
      background:rgba(0,0,0,0.85);
      color:#fff;
      padding:50px;
      border-radius:15px;
      margin-top:60px;
    }
    #scores { margin-top:20px; text-align:center; }
    table { border-collapse: collapse; margin: auto; }
    td, th { border: 1px solid #ffd700; padding: 10px; }
  </style>
</head>
<body>

<!-- Introduction -->
<div id="intro">
  <div id="grimoire"></div>
  <h1>üìñ L‚ÄôAcad√©mie des Arcanes üìñ</h1>
  <div id="introText"></div>
  <br>
  <button id="startBtn" onclick="startGame()">Commencer l‚Äôaventure</button>
</div>

<!-- Jeu principal -->
<div id="game" style="display:none;">
  <div id="timer">‚è≥ Temps restant : 60:00</div>
  <div id="enigmes"></div>
</div>

<!-- Fin -->
<div id="overlay"></div>

<audio id="musique" loop>
  <source src="https://files.catbox.moe/ij9cjq.mp3" type="audio/mpeg">
</audio>

<script>
/* --- Narration Intro --- */
let narration = [
  "Une ombre obscure grandit au c≈ìur de l‚ÄôAcad√©mie‚Ä¶",
  "Les Anciens parlent d‚Äôun sablier maudit, d√©versant la magie noire dans nos couloirs.",
  "Toi, Gardien, tu es le dernier espoir‚Ä¶",
  "R√©sous les √©nigmes sacr√©es avant que le temps ne s‚Äô√©coule,",
  "‚Ä¶ ou les t√©n√®bres engloutiront √† jamais la lumi√®re."
];
let i = 0, j = 0, speed = 50;
let introText = document.getElementById("introText");

function typeWriter() {
  if (i < narration.length) {
    if (j < narration[i].length) {
      introText.innerHTML += narration[i].charAt(j);
      j++;
      setTimeout(typeWriter, speed);
    } else {
      introText.innerHTML += "\n\n";
      i++; j = 0;
      setTimeout(typeWriter, 800);
    }
  } else {
    document.getElementById("startBtn").style.display = "inline-block";
  }
}
window.onload = () => { typeWriter(); };

/* --- Donn√©es du jeu --- */
let enigmes = [
  { question:"üîÆ Enigme 1 : Dans les flammes se cache la cl√©. Trouve le mot secret : F?E?", reponse:"feu", indice:"Cherche dans les cendres."},
  { question:"üïØÔ∏è Enigme 2 : Trois bougies br√ªlent. Le vent en √©teint deux. Combien restent allum√©es ?", reponse:"1", indice:"Ne r√©fl√©chis pas trop, imagine les flammes."},
  { question:"‚öñÔ∏è Enigme 3 : Je suis toujours devant toi mais jamais visible. Qui suis-je ?", reponse:"avenir", indice:"C‚Äôest le contraire du pass√©."},
  { question:"üìú Enigme 4 : D√©chiffre les runes : URYYB", reponse:"hello", indice:"Essaie ROT13 (chaque lettre d√©cal√©e de 13)."}
];
let current = 0;
let score = 0;
let timer = 3600; // 1h
let timerInterval, indiceInterval;
let scores = JSON.parse(localStorage.getItem("scores")) || [];

/* --- Lancer le jeu --- */
function startGame(){
  document.getElementById("intro").style.display="none";
  document.getElementById("game").style.display="block";
  document.getElementById("musique").play();

  afficherEnigme();
  timerInterval = setInterval(updateTimer,1000);
  indiceInterval = setInterval(proposerIndiceAleatoire, 90000); // toutes les 90s
}

/* --- Timer --- */
function updateTimer(){
  if(timer<=0){ gameOver(false); return; }
  timer--;
  let m=Math.floor(timer/60), s=timer%60;
  document.getElementById("timer").innerText=`‚è≥ Temps restant : ${m}:${s<10?'0'+s:s}`;
}

/* --- Enigmes --- */
function afficherEnigme(){
  if(current>=enigmes.length){ gameOver(true); return; }
  let e=enigmes[current];
  document.getElementById("enigmes").innerHTML=`
    <div class='enigme'>
      <p>${e.question}</p>
      <input id='rep' type='text' placeholder='Votre r√©ponse...'>
      <button onclick='verifier()'>Valider</button>
      <div id='feedback'></div>
    </div>`;
}
function verifier(){
  let rep=document.getElementById("rep").value.toLowerCase().trim();
  if(rep===enigmes[current].reponse){
    score+=10;
    current++;
    afficherEnigme();
  } else {
    document.getElementById("feedback").innerText="‚ùå Mauvaise r√©ponse !";
  }
}

/* --- Indices --- */
function proposerIndiceAleatoire(){
  if(current<enigmes.length){
    if(confirm("Voulez-vous un indice pour l'√©nigme actuelle ?")){
      alert("üí° Indice : "+enigmes[current].indice);
      score-=2;
    }
  }
}

/* --- Fin du jeu --- */
function gameOver(victoire){
  clearInterval(timerInterval);
  clearInterval(indiceInterval);
  document.getElementById("game").style.display="none";
  let o=document.getElementById("overlay");
  o.style.display="block";

  if(victoire){
    o.innerHTML=`<h1>üåü Victoire ! üåü</h1>
    <p>Les arcanes brillent de mille feux ! Vous avez sauv√© l‚ÄôAcad√©mie.<br>
    Les ma√Ætres mages inscrivent votre nom dans le Livre des H√©ros.</p>
    <button onclick="sauverScore()">Voir le tableau des scores</button>`;
  } else {
    o.innerHTML=`<h1>‚ò†Ô∏è D√©faite‚Ä¶</h1>
    <p>La magie noire s‚Äôest r√©pandue. Les flammes engloutissent l‚ÄôAcad√©mie.<br>
    Votre √©chec restera grav√© comme le dernier chapitre de ce monde‚Ä¶</p>
    <button onclick="sauverScore()">Voir le tableau des scores</button>`;
  }
}

/* --- Scores --- */
function sauverScore(){
  let pseudo=prompt("Entrez votre pseudo :");
  if(pseudo){
    scores.push({pseudo:pseudo, score:score});
    localStorage.setItem("scores",JSON.stringify(scores));
  }
  afficherScores();
}
function afficherScores(){
  let o=document.getElementById("overlay");
  scores.sort((a,b)=>b.score-a.score);
  let rows=scores.map(s=>`<tr><td>${s.pseudo}</td><td>${s.score}</td></tr>`).join("");
  o.innerHTML=`<h2>üèÜ Tableau des scores üèÜ</h2>
    <table><tr><th>Joueur</th><th>Score</th></tr>${rows}</table>`;
}
</script>
</body>
</html>
