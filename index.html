<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Escape Game - Acad√©mie des Arcanes</title>
  <style>
    body {
      font-family: 'Cinzel', serif;
      background: url('background.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #f5e6d3;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    #intro, #game, #endScreen {
      display: none;
      padding: 20px;
    }
    .enigme {
      background: rgba(0,0,0,0.7);
      border: 2px solid #bfa46f;
      border-radius: 15px;
      margin: 20px auto;
      padding: 20px;
      max-width: 600px;
      font-size: 1.2em;
      color: #fff9e6;
      text-shadow: 1px 1px 3px black;
    }
    .enigme input {
      margin-top: 10px;
      padding: 8px;
    }
    #timer {
      font-size: 1.5em;
      margin: 15px;
      color: #ffcc00;
      text-shadow: 2px 2px 5px black;
    }
    #indicePopup {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(30, 30, 30, 0.95);
      border: 3px solid #ffcc00;
      border-radius: 15px;
      padding: 20px;
      z-index: 1000;
      max-width: 400px;
      color: white;
      font-size: 1.1em;
      box-shadow: 0 0 20px gold;
    }
    .decor {
      position: absolute;
      width: 60px;
      height: 60px;
      background: url('spark.png') no-repeat center;
      background-size: contain;
      cursor: pointer;
    }
    #scoreBoard {
      display: none;
      margin-top: 20px;
      background: rgba(0,0,0,0.7);
      border: 2px solid gold;
      padding: 20px;
      border-radius: 15px;
    }
  </style>
</head>
<body>

  <!-- Musiques & Sons -->
  <audio id="musicIntro" src="assets/intro.mp3"></audio>
  <audio id="musicAmbient" src="assets/ambient.mp3" loop></audio>
  <audio id="musicVictory" src="assets/victory.mp3"></audio>
  <audio id="musicDefeat" src="assets/defeat.mp3"></audio>
  <audio id="soundIndice" src="assets/twinkle.mp3"></audio>
  <audio id="soundMagic" src="assets/mystical-chime.mp3"></audio>
  <audio id="soundSpark" src="assets/sparkle.mp3"></audio>
  <audio id="soundCrackle" src="assets/fire-crackle.mp3"></audio>

  <!-- Intro -->
  <div id="intro">
    <h1>‚ö° L‚ÄôAcad√©mie des Arcanes ‚ö°</h1>
    <p>Les t√©n√®bres menacent d‚Äôengloutir l‚ÄôAcad√©mie‚Ä¶</p>
    <p>Vous avez 60 minutes pour r√©soudre les √©nigmes et repousser la Magie Noire.</p>
    <button onclick="startGame()">Commencer l‚Äôaventure</button>
  </div>

  <!-- Jeu -->
  <div id="game">
    <div id="timer">‚è≥ Temps restant : 60:00</div>

    <div class="enigme" id="enigme1">
      <p>üîÆ √ânigme 1 :  
      Je suis pr√©sent le jour mais absent la nuit. Qui suis-je ?</p>
      <input type="text" id="rep1" placeholder="Votre r√©ponse...">
      <button onclick="checkAnswer(1, 'soleil')">Valider</button>
    </div>

    <div class="enigme" id="enigme2">
      <p>üìú √ânigme 2 :  
      Plus je grandis, moins on me voit. Qui suis-je ?</p>
      <input type="text" id="rep2" placeholder="Votre r√©ponse...">
      <button onclick="checkAnswer(2, 'ombre')">Valider</button>
    </div>

    <div class="enigme" id="enigme3">
      <p>üî• √ânigme 3 :  
      Je d√©vore tout sur mon passage, mais je meurs si on me donne √† boire. Qui suis-je ?</p>
      <input type="text" id="rep3" placeholder="Votre r√©ponse...">
      <button onclick="checkAnswer(3, 'feu')">Valider</button>
    </div>

    <div class="enigme" id="enigme4">
      <p>‚è≥ √ânigme 4 :  
      Je fuis sans jamais revenir. Qui suis-je ?</p>
      <input type="text" id="rep4" placeholder="Votre r√©ponse...">
      <button onclick="checkAnswer(4, 'temps')">Valider</button>
    </div>
  </div>

  <!-- Popup Indice -->
  <div id="indicePopup">
    <p id="indiceText"></p>
    <button onclick="closeIndice()">Fermer</button>
  </div>

  <!-- √âl√©ments d√©cor interactifs -->
  <div class="decor" style="top:80%; left:10%;" onclick="bonusDecor()"></div>
  <div class="decor" style="top:30%; left:80%;" onclick="bonusDecor()"></div>

  <!-- Fin -->
  <div id="endScreen">
    <h1 id="endTitle"></h1>
    <p id="endMessage"></p>
    <div id="scoreBoard"></div>
  </div>

<script>
let time = 3600; // 60 min
let timerInterval;
let solved = 0;
let indicesUsed = {};
let score = [];
let gameEnded = false;

// Indices par √©nigme
const indices = {
  1: "Indice : C‚Äôest une √©toile que l‚Äôon voit chaque jour.",
  2: "Indice : Tu le perds quand il fait nuit.",
  3: "Indice : Rougeoyant, il s‚Äô√©teint si tu l‚Äôarroses.",
  4: "Indice : On le mesure en secondes, minutes, heures..."
};

// Lancer le jeu
function startGame() {
  document.getElementById("intro").style.display = "none";
  document.getElementById("game").style.display = "block";
  document.getElementById("musicIntro").pause();
  document.getElementById("musicAmbient").play();
  startTimer();
  randomIndicePop();
}

// Timer
function startTimer() {
  timerInterval = setInterval(() => {
    if (time <= 0) {
      endGame(false);
    } else {
      time--;
      let min = Math.floor(time / 60);
      let sec = time % 60;
      document.getElementById("timer").innerText = 
        `‚è≥ Temps restant : ${min}:${sec.toString().padStart(2,'0')}`;
    }
  }, 1000);
}

// V√©rification r√©ponse
function checkAnswer(num, correct) {
  if (gameEnded) return;
  let rep = document.getElementById("rep"+num).value.toLowerCase();
  if (rep.includes(correct)) {
    document.getElementById("soundMagic").play();
    document.getElementById("enigme"+num).style.display="none";
    solved++;
    score.push({enigme:num, indice:false});
    if (solved === 4) endGame(true);
  }
}

// Popup indice
function showIndice(num) {
  if (indicesUsed[num]) return;
  indicesUsed[num] = true;
  document.getElementById("soundIndice").play();
  document.getElementById("indiceText").innerText = indices[num];
  document.getElementById("indicePopup").style.display="block";
}
function closeIndice() {
  document.getElementById("indicePopup").style.display="none";
}

// Indices al√©atoires
function randomIndicePop() {
  Object.keys(indices).forEach(num => {
    setTimeout(() => {
      if (!indicesUsed[num] && !gameEnded) showIndice(num);
    }, Math.random()*120000 + 30000); // entre 30s et 2min30
  });
}

// Bonus d√©cor
function bonusDecor() {
  document.getElementById("soundSpark").play();
  alert("‚ú® Vous avez trouv√© un bonus magique cach√© !");
}

// Fin du jeu
function endGame(victory) {
  gameEnded = true;
  clearInterval(timerInterval);
  document.getElementById("game").style.display="none";
  document.getElementById("musicAmbient").pause();

  let endTitle = document.getElementById("endTitle");
  let endMessage = document.getElementById("endMessage");

  if (victory) {
    document.getElementById("musicVictory").play();
    endTitle.innerText = "üéâ Victoire ! üéâ";
    endMessage.innerText = "Vous avez sauv√© l‚ÄôAcad√©mie des Arcanes !";
  } else {
    document.getElementById("musicDefeat").play();
    document.getElementById("soundCrackle").play();
    endTitle.innerText = "‚ò†Ô∏è D√©faite ‚ò†Ô∏è";
    endMessage.innerText = "La Magie Noire a englouti l‚ÄôAcad√©mie...";
  }

  document.getElementById("endScreen").style.display="block";
  showScores();
}

// Scores
function showScores() {
  let scoreBoard = document.getElementById("scoreBoard");
  scoreBoard.style.display = "block";
  scoreBoard.innerHTML = "<h2>Tableau des scores</h2>";
  score.forEach(s => {
    scoreBoard.innerHTML += `<p>√ânigme ${s.enigme} r√©solue sans indice</p>`;
  });
}
</script>
</body>
</html>
