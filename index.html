<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Escape Game : Acad√©mie des Arcanes</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
<style>
body { margin:0; font-family:Cinzel, serif; background:black; color:#f5f5f5; text-align:center; }
h1,h2,h3{ margin:10px 0; }
#intro, #game, #end { display:none; padding:20px; position:relative; }
#intro { display:flex; justify-content:center; align-items:center; height:100vh; background:black; color:gold; }
#introContent { background:rgba(0,0,0,0.6); padding:20px; border:2px solid gold; border-radius:15px; max-width:600px;
  transform: scaleY(0); transform-origin: top; animation: openBook 2s forwards, glowIntro 1.5s infinite alternate; filter:blur(4px);}
@keyframes openBook { 0% { transform: scaleY(0); opacity:0; } 50% { transform: scaleY(1.1); opacity:0.8; } 100% { transform: scaleY(1); opacity:1; } }
@keyframes glowIntro { 0% { box-shadow:0 0 5px gold; filter:blur(4px); } 100% { box-shadow:0 0 25px gold; filter:blur(0px); } }

#game #decor { position:absolute; top:0; left:0; width:100%; height:100%; background:url('images/decor-magique.jpg') no-repeat center center; background-size:cover; z-index:-1; display:none; }
.enigme { margin:20px auto; padding:15px; width:60%; background:rgba(0,0,0,0.6); border:2px solid gold; border-radius:10px; text-align:left; display:none; }
input, select{ margin-top:5px; padding:5px; }

.bonus, .objetDebloquant { position:absolute; width:50px; cursor:pointer; opacity:0; transition:transform 0.2s, opacity 1s; animation:clignote 2s infinite alternate, rotation 4s linear infinite; }
.objetDebloquant { border:2px solid gold; border-radius:50%; box-shadow:0 0 10px 5px gold; }
@keyframes clignote { 0%{opacity:0.5;}100%{opacity:1;} }
@keyframes rotation { 0%{transform:rotate(0deg);}100%{transform:rotate(360deg);} }
.fadeIn { opacity:1 !important; animation:appearBonus 1s ease-out forwards; }
@keyframes appearBonus { 0% { opacity:0; transform:scale(0.5) rotate(0deg); } 100% { opacity:1; transform:scale(1) rotate(0deg); } }

.victoire { animation: winEffect 2s ease-out forwards; }
@keyframes winEffect { 0%{transform:scale(0.5);opacity:0;color:gold;}50%{transform:scale(1.2);opacity:1;text-shadow:0 0 10px gold;}100%{transform:scale(1);opacity:1;text-shadow:0 0 20px gold;} }

.defaite { animation: loseEffect 1s ease-in forwards; }
@keyframes loseEffect { 0%{transform:rotate(0deg) translate(0,0);opacity:1;}25%{transform:rotate(-3deg) translate(-5px,5px);}50%{transform:rotate(3deg) translate(5px,-5px);}75%{transform:rotate(-2deg) translate(-3px,3px);}100%{transform:rotate(0deg) translate(0,0);opacity:0.9;} }

#bonusCounter{position:fixed; top:10px; right:10px; background:rgba(0,0,0,0.6); padding:10px; border:2px solid gold; border-radius:10px;}
#inventaire{position:fixed; bottom:0; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.7); border:2px solid gold; border-top-left-radius:10px; border-top-right-radius:10px; padding:10px; width:250px; text-align:center; cursor:pointer; z-index:2000;}
#contenuInventaire{display:none; margin-top:10px; display:flex; justify-content:center; gap:10px;}
#contenuInventaire img{width:40px; cursor:pointer;}
.popup{display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(20,20,20,0.95); padding:20px; border:3px solid gold; border-radius:10px; z-index:1000; width:50%; text-align:center;}
.popup button{margin:10px; padding:8px 15px; cursor:pointer;}
#end{display:none; height:100vh; padding:20px; color:gold;}
table{margin:20px auto; border-collapse:collapse; width:80%; color:gold;}
th,td{border:1px solid gold; padding:5px;}
</style>
</head>
<body>

<div id="intro">
  <div id="introContent">
    <h1>üåë Acad√©mie des Arcanes üåë</h1>
    <p>L‚Äôacad√©mie est plong√©e dans l‚Äôombre. Le grimoire ancestral a disparu.</p>
    <p>Entrez votre nom pour commencer :</p>
    <input type="text" id="pseudo" placeholder="Votre nom">
    <button onclick="startGame()">Commencer l‚Äôaventure</button>
  </div>
</div>

<div id="game">
  <div id="decor"></div>
  <h2>R√©solvez les √©nigmes ‚è≥</h2>
  <div id="timer">Temps restant : 60:00</div>

  <div class="enigme" id="enigme1" data-indice="Une teinte myst√©rieuse issue du m√©lange">
    <h3>√ânigme 1 : Potion de Couleurs</h3>
    <p>M√©lange rouge et bleu, quelle couleur appara√Æt ?</p>
    <input type="text" id="rep1">
    <button onclick="verifier(1)">Valider</button>
    <button onclick="demanderIndice(1)">üí° Indice</button>
    <p id="afficheIndice1" style="color:lightblue; display:none;"></p>
  </div>

  <div class="enigme" id="enigme2" data-indice="Cherchez un mot que l‚Äôon r√©p√®te dans les sorts">
    <h3>√ânigme 2 : Parchemin cod√©</h3>
    <p>D√©cale chaque lettre de 3 : KRODFR</p>
    <input type="text" id="rep2">
    <button onclick="verifier(2)">Valider</button>
    <button onclick="demanderIndice(2)">üí° Indice</button>
    <p id="afficheIndice2" style="color:lightblue; display:none;"></p>
  </div>

  <img id="objetCle" class="objetDebloquant" src="images/cl√©.png" style="top:50%; left:30%;" onclick="debloquerEnigme3()" title="Une cl√© myst√©rieuse, cliquez pour d√©bloquer une √©nigme.">

  <img src="images/bonus-fiole.png" class="bonus" id="bonusFiole" style="top:80%; left:15%;" title="Donne 2 minutes suppl√©mentaires" onclick="trouverBonus('fiole')">
  <img src="images/bonus-etoile.png" class="bonus" id="bonusEtoile" style="top:40%; left:70%;" title="Donne un indice suppl√©mentaire" onclick="trouverBonus('etoile')">
  <img src="images/bonus-grimoire.png" class="bonus" id="bonusGrimoire" style="top:60%; left:40%;" title="Grimoire magique trouv√©" onclick="trouverBonus('grimoire')">

  <div id="bonusCounter">Bonus collect√©s : 0</div>
  <div id="inventaire" onclick="toggleInventaire()">üì¶ Inventaire magique
    <div id="contenuInventaire"></div>
  </div>
</div>

<div id="end"></div>

<div class="popup" id="popupPouvoir">
  <p id="messagePouvoir"></p>
  <button onclick="closePouvoir()">Fermer</button>
</div>

<audio id="musiqueIntro" src="sons/intro.mp3" autoplay></audio>
<audio id="musiqueAmbiance" src="sons/ambiance.mp3" loop></audio>
<audio id="musiqueVictoire" src="sons/victoire.mp3"></audio>
<audio id="musiqueDefaite" src="sons/defaite.mp3"></audio>
<audio id="sonIndice" src="sons/indice.mp3"></audio>
<audio id="sonBonus" src="sons/bonus.mp3"></audio>

<script>
let tempsRestant=3600, timerInterval, inventaire=[], bonusCollectes=0, startTime, pseudo="", indicesUtilises={1:false,2:false,3:false};

function startGame(){
  pseudo=document.getElementById("pseudo").value||"Joueur";
  document.getElementById("intro").style.display="none";
  document.getElementById("game").style.display="block";
  startTime=new Date().getTime();
  document.getElementById("decor").style.display="block";
  document.getElementById("enigme1").style.display="block";
  document.getElementById("musiqueIntro").pause();
  document.getElementById("musiqueAmbiance").play();
  timerInterval=setInterval(updateTimer,1000);
  afficherBonusEtObjets();
}

function updateTimer(){
  tempsRestant--;
  let m=Math.floor(tempsRestant/60), s=tempsRestant%60;
  document.getElementById("timer").innerText=`Temps restant : ${m}:${s.toString().padStart(2,'0')}`;
  if(tempsRestant<=0){ clearInterval(timerInterval); finPerdue();}
}

function verifier(num){
  let r=document.getElementById("rep"+num).value.toLowerCase();
  let correct=(num==1 && r==="violet")||(num==2 && r==="sort")||(num==3 && r==="magie");
  if(correct){
    document.getElementById("enigme"+num)?.style.display="none";
    if(num===1) document.getElementById("enigme2").style.display="block";
    if(document.querySelectorAll(".enigme[style*='display: block']").length===0) finGagnee();
  }else alert("Ce n‚Äôest pas encore la bonne r√©ponse...");
}

function demanderIndice(num){
  if(indicesUtilises[num]){ alert("Indice d√©j√† utilis√© !"); return; }
  let ok=confirm("Voulez-vous utiliser un indice subtil pour cette √©nigme ?");
  if(ok){
    let i=document.getElementById("enigme"+num).getAttribute("data-indice");
    document.getElementById("afficheIndice"+num).innerText=i;
    document.getElementById("afficheIndice"+num).style.display="block";
    document.getElementById("sonIndice").play();
    indicesUtilises[num]=true;
  }
}

function toggleInventaire(){
  let c=document.getElementById("contenuInventaire");
  c.style.display=c.style.display==="none"?"flex":"none";
}

function trouverBonus(type){
  document.getElementById("sonBonus").play();
  let message="";
  if(type==="fiole"){ tempsRestant+=120; message="‚è≥ 2 min suppl√©mentaires !"; }
  if(type==="etoile"){ message="‚ú® Indice suppl√©mentaire disponible."; }
  if(type==="grimoire"){ message="üìñ Grimoire magique trouv√©."; }
  bonusCollectes++;
  document.getElementById("bonusCounter").innerText="Bonus collect√©s : "+bonusCollectes;
  let img=document.createElement("img");
  img.src="images/bonus-"+type+".png";
  img.title=message;
  img.onclick=function(){ alert(message); }
  document.getElementById("contenuInventaire").appendChild(img);
  document.getElementById("popupPouvoir").style.display="block";
  document.getElementById("messagePouvoir").innerText=message;
  document.getElementById("bonus"+type.charAt(0).toUpperCase()+type.slice(1)).style.display="none";
}

function closePouvoir(){ document.getElementById("popupPouvoir").style.display="none"; }

function debloquerEnigme3(){
  alert("Vous avez trouv√© une cl√© ! Une nouvelle √©nigme appara√Æt !");
  let enigme3=document.createElement("div");
  enigme3.className="enigme";
  enigme3.id="enigme3";
  enigme3.setAttribute("data-indice","R√©fl√©chissez √† ce qui est invisible mais pr√©sent partout");
  enigme3.innerHTML='<h3>√ânigme 3 : Message cach√©</h3><p>La magie est partout.</p><input type="text" id="rep3"><button onclick="verifier(3)">Valider</button><button onclick="demanderIndice(3)">üí° Indice</button><p id="afficheIndice3" style="color:lightblue; display:none;"></p>';
  document.getElementById("game").appendChild(enigme3);
  document.getElementById("objetCle").style.display="none";
}

function afficherBonusEtObjets(){
  ["Fiole","Etoile","Grimoire"].forEach(type=>{
    let el=document.getElementById("bonus"+type);
    setTimeout(()=>{ el.classList.add("fadeIn"); },500 + Math.random()*1000);
  });
  let cle=document.getElementById("objetCle");
  setTimeout(()=>{ cle.classList.add("fadeIn"); },1500);
}

function finGagnee(){
  clearInterval(timerInterval);
  document.getElementById("game").style.display="none";
  let end=document.getElementById("end"); end.style.display="block";
  let elapsed=Math.floor((new Date().getTime()-startTime)/1000);
  end.innerHTML="<h1 class='victoire'>‚ú® Victoire ! ‚ú®</h1><p>Vous avez sauv√© l'acad√©mie, "+pseudo+" !</p>";
  end.innerHTML+="<h2>Tableau des scores</h2>";
  end.innerHTML+="<table><tr><th>Nom</th><th>R√©sultat</th><th>Temps (s)</th><th>Bonus utilis√©s</th></tr>";
  end.innerHTML+="<tr><td>"+pseudo+"</td><td>Gagn√©</td><td>"+elapsed+"</td><td>"+bonusCollectes+"</td></tr></table>";
  document.getElementById("musiqueAmbiance").pause();
  document.getElementById("musiqueVictoire").play();
}

function finPerdue(){
  clearInterval(timerInterval);
  document.getElementById("game").style.display="none";
  let end=document.getElementById("end"); end.style.display="block";
  end.innerHTML="<h1 class='defaite'>‚ò† D√©faite... ‚ò†</h1><p>La magie noire a englouti l'acad√©mie.</p>";
  end.innerHTML+="<h2>Tableau des scores</h2>";
  end.innerHTML+="<table><tr><th>Nom</th><th>R√©sultat</th><th>Temps (s)</th><th>Bonus utilis√©s</th></tr>";
  end.innerHTML+="<tr><td>"+pseudo+"</td><td>Perdu</td><td>"+(3600-tempsRestant)+"</td><td>"+bonusCollectes+"</td></tr></table>";
  document.getElementById("musiqueAmbiance").pause();
  document.getElementById("musiqueDefaite").play();
}
</script>
</body>
</html>
