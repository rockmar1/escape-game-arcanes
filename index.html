<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Escape Game : AcadÃ©mie des Arcanes</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@600&family=Quicksand:wght@400;600&display=swap');
    body { margin:0; background:#0b0c10; color:white; font-family:'Quicksand', sans-serif; text-align:center; }
    #intro, #game, #overlay { display:none; }
    #intro {
      position:fixed; top:0; left:0; width:100%; height:100%;
      background:black; display:flex; justify-content:center; align-items:center; flex-direction:column;
      font-family:'Cinzel', serif; font-size:1.5em; color:#ffd369; padding:30px;
    }
    #intro p { opacity:0; animation: fadeIn 4s forwards; margin-bottom:20px;}
    @keyframes fadeIn { to {opacity:1;} }
    #decor { margin-top:20px; font-size:1.8em; }
    .hiddenIndice { display:none; color:#90ee90; margin-top:10px; font-style:italic; }
    .clickable { cursor:pointer; transition:0.2s; }
    .clickable:hover { transform:scale(1.3); }
    table { border-collapse:collapse; margin:auto; margin-top:20px; width:90%; }
    th, td { border:1px solid #444; padding:10px; }
    #overlay { font-size:2em; }
  </style>
</head>
<body>

  <!-- INTRO DRAMATIQUE -->
  <div id="intro">
    <p style="animation-delay:0s">ğŸŒ‘ Dans les profondeurs de lâ€™AcadÃ©mieâ€¦</p>
    <p style="animation-delay:4s">Une ombre grandit, corrompant les arcanesâ€¦</p>
    <p style="animation-delay:8s">Le Grimoire des SortilÃ¨ges Anciens a Ã©tÃ© dÃ©robÃ©.</p>
    <p style="animation-delay:12s">Si vous Ã©chouez, la magie noire rÃ©gnera Ã©ternellement.</p>
    <button style="margin-top:40px; display:none;" id="startBtn" onclick="startGame()">âš”ï¸ Commencer la quÃªte</button>
  </div>

  <!-- JEU -->
  <div id="game">
    <h1>ğŸ”® AcadÃ©mie des Arcanes ğŸ”®</h1>
    <div id="timer">â³ Temps restant : 60:00</div>

    <!-- DÃ©cor interactif -->
    <div id="decor">
      âœ¨
      <span class="clickable" onclick="revealHiddenIndice(1)">ğŸ•¯ï¸</span>
      ğŸ”¥
      <span class="clickable" onclick="revealHiddenIndice(2)">âš¡</span>
      ğŸŒ‘
      <span class="clickable" onclick="revealHiddenIndice(3)">ğŸ</span>
    </div>
    <div id="hidden1" class="hiddenIndice">ğŸ’¡ Lâ€™ombre cache parfois la lumiÃ¨re...</div>
    <div id="hidden2" class="hiddenIndice">ğŸ’¡ Les nombres parlent plus que les mots...</div>
    <div id="hidden3" class="hiddenIndice">ğŸ’¡ Parfois, ce qui est inversÃ© cache la vÃ©ritÃ©...</div>

    <!-- Tableau Ã©nigmes -->
    <table>
      <tr><th>Ã‰nigme</th><th>Question</th><th>RÃ©ponse</th></tr>
      <tr><td>Suite Arcanique</td><td>ComplÃ¨te : 2, 4, 8, 16, ... ?</td><td><input type="text" id="q1"></td></tr>
      <tr><td>Crypte ChiffrÃ©e</td><td>ROT13 : â€œCebtenzzâ€</td><td><input type="text" id="q2"></td></tr>
      <tr><td>PiÃ¨ge de Logique</td><td>A dit : "Je mens toujours"<br>B : "A ment"<br>C : "B dit vrai"<br>Qui ment ? (A/B/C)</td><td><input type="text" id="q3"></td></tr>
      <tr><td>Ã‰nigme des Runes</td><td>Mot cachÃ© : "SRROOH"</td><td><input type="text" id="q4"></td></tr>
      <tr><td>Ã‰toiles Arcanes</td><td>Combien de branches a un pentagramme ?</td><td><input type="text" id="q5"></td></tr>
      <tr><td>Potion Temporelle</td><td>Si hier Ã©tait demain, aujourdâ€™hui serait ?</td><td><input type="text" id="q6"></td></tr>
      <tr><td>Cadenas des Ombres</td><td>Code : somme de 13 + 27 + 45</td><td><input type="text" id="q7"></td></tr>
      <tr><td>Sphinx Final</td><td>Je parle sans bouche et jâ€™entends sans oreilles. Qui suis-je ?</td><td><input type="text" id="q8"></td></tr>
    </table>

    <button onclick="verifier()">ğŸ”‘ VÃ©rifier les rÃ©ponses</button>
  </div>

  <!-- Ã‰CRAN DE FIN -->
  <div id="overlay"></div>

  <audio id="bgm" loop>
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_0a2e4c2375.mp3?filename=dark-ambient-110624.mp3" type="audio/mpeg">
  </audio>

  <script>
    let temps=60*60, timerInterval;
    let reponses = ["32","program","c","spool","5","lundi","85","echo"];
    let scores = [];
    let indicesUtilises = 0;

    // Intro
    setTimeout(()=>{ document.getElementById("startBtn").style.display="block"; },15000);

    function startGame(){
      document.getElementById("intro").style.display="none";
      document.getElementById("game").style.display="block";
      document.getElementById("bgm").play();
      startTimer();
      setInterval(popRandomIndice, 300000); // toutes les 5min
    }

    function startTimer(){
      timerInterval=setInterval(()=>{
        let min=Math.floor(temps/60), sec=temps%60;
        document.getElementById("timer").innerText=`â³ Temps restant : ${min}:${sec.toString().padStart(2,"0")}`;
        temps--;
        if(temps<0){ clearInterval(timerInterval); gameOver(false); }
      },1000);
    }

    function revealHiddenIndice(id){
      document.getElementById("hidden"+id).style.display="block";
    }

    function popRandomIndice(){
      if(confirm("Voulez-vous un indice mystÃ¨re ?")){
        indicesUtilises++;
        let indices = [
          "Regardez les lettres Ã  lâ€™envers...",
          "Les nombres se rÃ©pÃ¨tent parfois par 2...",
          "La rÃ©ponse est plus simple quâ€™elle nâ€™y paraÃ®t...",
          "Les runes se lisent Ã  lâ€™envers..."
        ];
        alert(indices[Math.floor(Math.random()*indices.length)]);
      }
    }

    function verifier(){
      let all=true;
      for(let i=1;i<=8;i++){
        let r=document.getElementById("q"+i).value.toLowerCase().trim();
        if(r!==reponses[i-1]) all=false;
      }
      if(all) gameOver(true);
      else alert("âŒ Certaines rÃ©ponses sont fausses !");
    }

    function gameOver(victoire){
      clearInterval(timerInterval);
      document.getElementById("game").style.display="none";
      let o=document.getElementById("overlay");
      o.style.display="flex"; o.style.flexDirection="column"; o.style.justifyContent="center"; o.style.alignItems="center"; o.style.height="100vh";
      document.getElementById("bgm").pause();

      if(victoire){
        o.innerHTML="<h1>ğŸ† Victoire ! Vous avez sauvÃ© lâ€™AcadÃ©mie.</h1>";
      } else {
        o.innerHTML="<h1>â˜ ï¸ La magie noire a vaincu lâ€™AcadÃ©mie des Arcanes...</h1>";
      }

      // Ajouter tableau des scores ici uniquement
      let scoreFinal = Math.max(0, temps - (indicesUtilises*60)); // pÃ©nalitÃ© 1 min par indice utilisÃ©
      o.innerHTML += `
        <div style="margin-top:30px;">
          <h2>ğŸ† Tableau des Scores</h2>
          <input type="text" id="pseudo" placeholder="Votre pseudo">
          <button onclick="enregistrerScore(${scoreFinal})">Enregistrer</button>
          <ul id="scoreboard"></ul>
        </div>
      `;
    }

    function enregistrerScore(scoreFinal){
      let pseudo=document.getElementById("pseudo").value;
      if(!pseudo) return alert("Entrez un pseudo !");
      scores.push({nom:pseudo, score:scoreFinal});
      scores.sort((a,b)=>b.score-a.score);
      afficherScores();
    }

    function afficherScores(){
      let ul=document.getElementById("scoreboard");
      ul.innerHTML="";
      scores.forEach(s=>{ 
        let li=document.createElement("li"); 
        li.textContent=`${s.nom} - ${s.score} pts`; 
        ul.appendChild(li); 
      });
    }
  </script>
</body>
</html>
