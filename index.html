<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Escape Game : Acad√©mie des Arcanes</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
<style>
body { margin:0; font-family:Cinzel, serif; background:black; color:#f5f5f5; overflow:hidden;}
h1,h2,h3{margin:10px 0;}

/* Choix pseudo */
#choixPseudo{display:flex; flex-direction:column; justify-content:center; align-items:center; height:100vh; background:black; color:gold;}

/* Intro grimoire */
#intro{display:none; justify-content:center; align-items:center; height:100vh; background:black; color:gold; overflow:hidden;}
#introContent{background:rgba(0,0,0,0.6); padding:20px; border:2px solid gold; border-radius:15px; max-width:600px; overflow:hidden; transform: scaleY(0); transform-origin:top; animation: openBook 2s forwards;}
.line {opacity:0; margin:10px 0; font-size:1.2em; transition: opacity 0.8s ease-in;}
#startBtn {display:none; margin-top:15px; padding:10px 20px; cursor:pointer;}

/* Animation grimoire */
@keyframes openBook{0%{transform:scaleY(0); opacity:0;}50%{transform:scaleY(1.1);opacity:0.8;}100%{transform:scaleY(1);opacity:1;}}

/* Jeu */
#game{display:none; position:relative;}
#decor{position:absolute; top:0; left:0; width:100%; height:100%; background:url('images/decor-magique.jpg') no-repeat center center; background-size:cover; z-index:-1; display:none;}

/* √ânigmes */
.enigme{margin:20px auto; padding:15px; width:60%; background:rgba(0,0,0,0.6); border:2px solid gold; border-radius:10px; text-align:left; display:none; opacity:0; transform: scale(0.8) translateY(20px); transition: all 0.8s ease;}
.enigme.show{display:block; opacity:1; transform: scale(1) translateY(0); box-shadow: 0 0 15px gold; animation: glowEnigme 1.5s infinite alternate;}
@keyframes glowEnigme {0% {box-shadow:0 0 10px gold;}100% {box-shadow:0 0 25px gold;}}

/* Bonus et objet */
.bonus, .objetDebloquant{position:absolute; width:50px; cursor:pointer; opacity:0; transition:transform 0.2s, opacity 1s; animation:clignote 2s infinite alternate, rotation 4s linear infinite;}
.objetDebloquant{border:2px solid gold; border-radius:50%; box-shadow:0 0 10px 5px gold;}
@keyframes clignote{0%{opacity:0.5;}100%{opacity:1;}}
@keyframes rotation{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
.fadeIn{opacity:1 !important; animation:appearBonus 1s ease-out forwards;}
@keyframes appearBonus{0%{opacity:0; transform:scale(0.5) rotate(0deg);}100%{opacity:1; transform:scale(1) rotate(0deg);}}
@keyframes pulseBonus{0%{transform:scale(1);}50%{transform:scale(1.2);}100%{transform:scale(1);}}

/* Compteur bonus */
#bonusCounter{position:fixed; top:10px; right:10px; background:rgba(0,0,0,0.6); padding:10px; border:2px solid gold; border-radius:10px;}

/* Inventaire */
#inventaire{position:fixed; bottom:0; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.7); border:2px solid gold; border-top-left-radius:10px; border-top-right-radius:10px; padding:10px; width:250px; text-align:center; cursor:pointer; z-index:2000;}
#contenuInventaire{display:none; margin-top:10px; display:flex; justify-content:center; gap:10px;}
#contenuInventaire img{width:40px; cursor:pointer;}
#contenuInventaire img:hover{animation:scintille 1s infinite alternate;}
@keyframes scintille{0% { transform: scale(1); filter: drop-shadow(0 0 5px gold);}50% { transform: scale(1.2); filter: drop-shadow(0 0 15px gold);}100% { transform: scale(1); filter: drop-shadow(0 0 5px gold);}}

/* Popup */
.popup{display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(20,20,20,0.95); padding:20px; border:3px solid gold; border-radius:10px; z-index:1000; width:50%; text-align:center;}
.popup button{margin:10px; padding:8px 15px; cursor:pointer;}

/* Flash magique */
.flashMagic {position: absolute; width:100px; height:100px; background: radial-gradient(circle, gold 0%, transparent 70%); border-radius:50%; pointer-events: none; opacity:0.8; animation: flash 0.6s ease-out forwards; z-index:3000;}
@keyframes flash{0%{transform:scale(0); opacity:0.8;}50%{transform:scale(1.5); opacity:1;}100%{transform:scale(2); opacity:0;}}

/* Tremblement √©nigme erreur */
.tremblementEnigme {animation: shakeEnigme 0.5s ease-in-out 1;}
@keyframes shakeEnigme{0% { transform: translate(0px,0px) rotate(0deg);}20% { transform: translate(-5px,2px) rotate(-2deg);}40% { transform: translate(5px,-3px) rotate(2deg);}60% { transform: translate(-3px,3px) rotate(-1deg);}80% { transform: translate(3px,-2px) rotate(1deg);}100% { transform: translate(0px,0px) rotate(0deg);}}

/* Victoire/Defaite */
.victoire{animation:winEffect 2s ease-out forwards;}
@keyframes winEffect{0%{transform:scale(0.5);opacity:0;color:gold;}50%{transform:scale(1.2);opacity:1;text-shadow:0 0 10px gold;}100%{transform:scale(1);opacity:1;text-shadow:0 0 20px gold;}}
.defaite{animation:loseEffect 1s ease-in forwards;}
@keyframes loseEffect{0%{transform:rotate(0deg) translate(0,0);opacity:1;}25%{transform:rotate(-3deg) translate(-5px,5px);}50%{transform:rotate(3deg) translate(5px,-5px);}75%{transform:rotate(-2deg) translate(-3px,3px);}100%{transform:rotate(0deg) translate(0,0);opacity:0.9;}}

/* Confettis */
.confetti {position:fixed; top:0; width:10px; height:10px; background:gold; opacity:0.8; pointer-events:none; z-index:3000; animation:fall 3s linear infinite;}
@keyframes fall {0%{transform:translateY(0) rotate(0deg);}100%{transform:translateY(100vh) rotate(360deg);}}

/* Fum√©e d√©faite */
.fumee {position:fixed; bottom:0; width:100%; height:100%; background: radial-gradient(circle, rgba(50,50,50,0.5) 0%, transparent 70%); pointer-events:none; animation:fumeUp 4s linear forwards; z-index:2500;}
@keyframes fumeUp {0%{transform:translateY(100%);}100%{transform:translateY(-100%); opacity:0;}}

/* Tremblement √©cran */
.tremblement { animation:shake 0.5s infinite; }
@keyframes shake {0% {transform: translate(0px,0px) rotate(0deg);}25% {transform: translate(-5px,5px) rotate(-2deg);}50% {transform: translate(5px,-5px) rotate(2deg);}75% {transform: translate(-3px,3px) rotate(-1deg);}100% {transform: translate(0px,0px) rotate(0deg);}}

#end{display:none; height:100vh; padding:20px; color:gold;}
table{margin:20px auto; border-collapse:collapse; width:80%; color:gold;}
th,td{border:1px solid gold; padding:5px;}
</style>
</head>
<body>

<!-- Choix pseudo -->
<div id="choixPseudo">
<h1>üåë Acad√©mie des Arcanes üåë</h1>
<p>Entrez votre nom :</p>
<input type="text" id="pseudo" placeholder="Votre nom">
<button onclick="validerPseudo()">Valider</button>
</div>

<!-- Intro grimoire -->
<div id="intro">
<div id="introContent">
<h1>üåë Acad√©mie des Arcanes üåë</h1>
<div id="introLines">
<p class="line">Une ombre mal√©fique plane sur l'acad√©mie...</p>
<p class="line">Le grimoire ancien a disparu.</p>
<p class="line">Vous seul pouvez le retrouver et sauver l'acad√©mie.</p>
<p class="line">Pr√©parez-vous √† plonger dans le myst√®re et la magie !</p>
</div>
<button id="startBtn" onclick="startGame()">Commencer l‚Äôaventure</button>
</div>
</div>

<!-- Jeu -->
<div id="game">
<div id="decor"></div>
<h2>R√©solvez les √©nigmes avant la fin du sablier ‚è≥</h2>
<div id="timer">Temps restant : 60:00</div>

<!-- √ânigmes -->
<div class="enigme" id="enigme1" data-indice="M√©lange de rouge et bleu ‚Üí violet">
<h3>√ânigme 1 : Potion de Couleurs</h3>
<p>M√©lange rouge et bleu, quelle couleur appara√Æt ?</p>
<input type="text" id="rep1"><button onclick="verifier(1)">Valider</button>
<button onclick="demanderIndice(1)">üí° Indice</button>
<p id="afficheIndice1" style="color:lightblue; display:none;"></p>
</div>

<div class="enigme" id="enigme2" data-indice="D√©calage C√©sar ‚Üí sort">
<h3>√ânigme 2 : Parchemin cod√©</h3>
<p>D√©cale chaque lettre de 3 : KRODFR</p>
<input type="text" id="rep2"><button onclick="verifier(2)">Valider</button>
<button onclick="demanderIndice(2)">üí° Indice</button>
<p id="afficheIndice2" style="color:lightblue; display:none;"></p>
</div>

<div class="enigme" id="enigme3" data-indice="Le dernier sort n√©cessite la magie absolue">
<h3>√ânigme 3 : Sort final</h3>
<p>Quel mot magique compl√®te le rituel ?</p>
<input type="text" id="rep3"><button onclick="verifier(3)">Valider</button>
<button onclick="demanderIndice(3)">üí° Indice</button>
<p id="afficheIndice3" style="color:lightblue; display:none;"></p>
</div>

<!-- Objet d√©bloquant √©nigme -->
<img src="images/cl√©.png" class="objetDebloquant" id="cle" style="top:60%; left:50%;" title="Cliquez pour d√©bloquer l'√©nigme 3" onclick="debloquerEnigme(3)">

<!-- Bonus -->
<img src="images/bonus-fiole.png" class="bonus" id="bonus1" style="top:80%; left:20%;" onclick="trouverBonus(this,'fiole')" title="Fiole : +2 min">
<img src="images/bonus-etoile.png" class="bonus" id="bonus2" style="top:40%; left:70%;" onclick="trouverBonus(this,'etoile')" title="√âtoile : indice secret">
<img src="images/bonus-grimoire.png" class="bonus" id="bonus3" style="top:60%; left:40%;" onclick="trouverBonus(this,'grimoire')" title="Grimoire : pouvoir magique">

<!-- Inventaire -->
<div id="inventaire" onclick="toggleInventaire()">üì¶ Inventaire magique
<div id="contenuInventaire"></div>
</div>

<!-- Compteur bonus -->
<div id="bonusCounter">Bonus : 0</div>

<!-- Popups -->
<div id="popupIndice" class="popup">
<p id="popupMessage"></p>
<button onclick="revealIndice()">Oui</button>
<button onclick="closePopup()">Non</button>
</div>

<div id="popupBonus" class="popup">
<p id="bonusMessage"></p>
<button onclick="closeBonus()">Fermer</button>
</div>

<!-- Fin -->
<div id="end"></div>

<!-- Audio -->
<audio id="musiqueIntro" src="sons/intro.mp3"></audio>
<audio id="musiqueAmbiance" src="sons/ambiance.mp3" loop></audio>
<audio id="musiqueVictoire" src="sons/victoire.mp3"></audio>
<audio id="musiqueDefaite" src="sons/defaite.mp3"></audio>
<audio id="sonIndice" src="sons/indice.mp3"></audio>
<audio id="sonBonus" src="sons/bonus.mp3"></audio>
<audio id="sonFlash" src="sons/flash.mp3"></audio>
<audio id="sonErreur" src="sons/erreur.mp3"></audio>
<audio id="sonSurvol" src="sons/survol.mp3"></audio>

<script>
// === VARIABLES ===
let pseudo="", tempsRestant=3600, timerInterval, bonusCollectes=0, inventaire=[], indicesUtilises={}, startTime;
let indiceActuelNum=null;

// === PSEUDO & INTRO ===
function validerPseudo(){
pseudo=document.getElementById("pseudo").value.trim();
if(pseudo==""){alert("Veuillez entrer un nom"); return;}
document.getElementById("choixPseudo").style.display="none";
document.getElementById("intro").style.display="flex";
document.getElementById("musiqueIntro").play();
showIntroLines();
}
function showIntroLines(){
const lines=document.querySelectorAll('#introLines .line');
let delay=0;
lines.forEach((line,i)=>{
setTimeout(()=>{
line.style.opacity=1;
if(i===lines.length-1) document.getElementById('startBtn').style.display='inline-block';
}, delay);
delay+=2000;
});
}

// === START GAME ===
function startGame(){
document.getElementById("intro").style.display="none";
document.getElementById("game").style.display="block";
document.getElementById("decor").style.display="block";
document.getElementById("enigme1").classList.add("show");
startTime=new Date().getTime();
timerInterval=setInterval(updateTimer,1000);
}

// === TIMER ===
function updateTimer(){
tempsRestant--;
let minutes=Math.floor(tempsRestant/60), secondes=tempsRestant%60;
document.getElementById("timer").innerText=`Temps restant : ${minutes}:${secondes.toString().padStart(2,'0')}`;
if(tempsRestant<=0){clearInterval(timerInterval); finPerdue();}
}

// === INDICES ===
function demanderIndice(num){
if(indicesUtilises[num]){alert("Indice d√©j√† utilis√©"); return;}
indiceActuelNum=num;
document.getElementById("popupMessage").innerText="Voulez-vous un indice ?";
document.getElementById("popupIndice").style.display="block";
}
function revealIndice(){
document.getElementById("afficheIndice"+indiceActuelNum).innerText=document.getElementById("enigme"+indiceActuelNum).dataset.indice;
document.getElementById("afficheIndice"+indiceActuelNum).style.display="block";
indicesUtilises[indiceActuelNum]=true;
document.getElementById("sonIndice").play();
closePopup();
}
function closePopup(){document.getElementById("popupIndice").style.display="none";}

// === V√âRIFICATION √âNIGMES ===
function verifier(num){
let reponse=document.getElementById("rep"+num).value.toLowerCase();
let correcte=(num==1 && reponse=="violet")||(num==2 && reponse=="sort")||(num==3 && reponse=="magie");
let enigmeEl=document.getElementById("enigme"+num);
if(correcte){
effetMagique(enigmeEl);
enigmeEl.remove();
if(num==1) document.getElementById("enigme2").classList.add("show");
if(num==3) finGagnee();
}else{
enigmeEl.classList.add("tremblementEnigme");
document.getElementById("sonErreur").currentTime=0;
document.getElementById("sonErreur").play();
setTimeout(()=>enigmeEl.classList.remove("tremblementEnigme"),500);
}
}

// === EFFET FLASH ===
function effetMagique(el){
let rect=el.getBoundingClientRect();
let flash=document.createElement("div"); flash.className="flashMagic";
flash.style.left=(rect.left+rect.width/2-50)+"px";
flash.style.top=(rect.top+rect.height/2-50)+"px";
document.body.appendChild(flash);
document.getElementById("sonFlash").currentTime=0; document.getElementById("sonFlash").play();
setTimeout(()=>flash.remove(),600);
}

// === BONUS ===
function trouverBonus(el,type){
document.getElementById("sonBonus").play();
let message="";
if(type=="fiole"){tempsRestant+=120; message="‚è≥ +2 minutes !";}
else if(type=="etoile"){message="‚ú® Indice secret !";}
else if(type=="grimoire"){message="üìñ Pouvoir magique activ√© !";}
inventaire.push(type); bonusCollectes++;
document.getElementById("bonusCounter").innerText="Bonus : "+bonusCollectes;
let invDiv=document.getElementById("contenuInventaire");
let img=document.createElement("img");
img.src="images/bonus-"+type+".png"; img.title=message;
invDiv.appendChild(img);
el.style.display="none";
document.getElementById("bonusMessage").innerText=message;
document.getElementById("popupBonus").style.display="block";
}
function closeBonus(){document.getElementById("popupBonus").style.display="none";}

// === OBJET DEBLOQUANT ===
function debloquerEnigme(num){
document.getElementById("enigme"+num).classList.add("show");
document.getElementById("cle").style.display="none";
}

// === INVENTAIRE ===
function toggleInventaire(){
let contenu=document.getElementById("contenuInventaire");
contenu.style.display=contenu.style.display==="none"?"flex":"none";
}

// === FINS ===
function finGagnee(){
clearInterval(timerInterval);
document.getElementById("game").style.display="none";
let duree=Math.floor((new Date().getTime()-startTime)/1000);
document.getElementById("end").style.display="block";
document.getElementById("end").innerHTML='<h1 class="victoire">‚ú® Victoire ! ‚ú®</h1><p>'+pseudo+' a sauv√© l\'acad√©mie !</p><p>Temps : '+Math.floor(duree/60)+' min '+(duree%60)+' s</p><p>Bonus utilis√©s : '+bonusCollectes+'</p><table><thead><tr><th>Nom</th><th>Gagn√©</th><th>Temps (s)</th><th>Bonus</th><th>Indices</th></tr></thead><tbody></tbody></table>';
document.getElementById("musiqueAmbiance").pause(); document.getElementById("musiqueVictoire").play();
lancerConfettis(); enregistrerScore(true,duree);
}
function finPerdue(){
document.getElementById("game").style.display="none";
document.getElementById("end").style.display="block";
document.getElementById("end").innerHTML='<h1 class="defaite">‚ò† D√©faite... ‚ò†</h1><p>'+pseudo+' n\'a pas sauv√© l\'acad√©mie.</p><p>Bonus collect√©s : '+bonusCollectes+'</p><table><thead><tr><th>Nom</th><th>Gagn√©</th><th>Temps (s)</th><th>Bonus</th><th>Indices</th></tr></thead><tbody></tbody></table>';
document.getElementById("musiqueAmbiance").pause(); document.getElementById("musiqueDefaite").play();
effetDefaite(); enregistrerScore(false,3600-tempsRestant);
}

// === CONFETTIS ===
function lancerConfettis(){for(let i=0;i<100;i++){let div=document.createElement("div"); div.className="confetti"; div.style.left=Math.random()*100+"%"; document.body.appendChild(div);}}

// === FUM√âE / TREMBLEMENT ===
function effetDefaite(){let f=document.createElement("div"); f.className="fumee tremblement"; document.body.appendChild(f); setTimeout(()=>f.remove(),4000);}

// === TABLEAU SCORES ===
function enregistrerScore(gagne,duree){
let tbody=document.querySelector("#end tbody");
let tr=document.createElement("tr");
tr.innerHTML=`<td>${pseudo}</td><td>${gagne?"Gagn√©":"Perdu"}</td><td>${gagne?duree:"-"}</td><td>${bonusCollectes}</td><td>${Object.keys(indicesUtilises).length}</td>`;
tbody.appendChild(tr);
}
</script>
</body>
</html>
