<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Escape Game : Acad√©mie des Arcanes</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ---------------------- BASE ---------------------- */
body {
  margin: 0;
  font-family: "Cinzel", serif;
  background: black;
  color: #f5f5f5;
  text-align: center;
  overflow-x: hidden;
}
h1,h2,h3 { margin: 10px 0; }

/* ---------------------- INTRO ---------------------- */
#intro {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background: url('images/decor-magique.jpg') no-repeat center center fixed;
  background-size: cover;
  position: relative;
  overflow: hidden;
  color: gold;
  font-size: 1.2em;
}
#introContent {
  background: rgba(0,0,0,0.6);
  padding: 20px;
  border: 2px solid gold;
  border-radius: 15px;
  max-width: 600px;
  z-index: 10;
}
.grimoirePage {
  position: absolute;
  width: 100%;
  height: 100%;
  background: rgba(255,255,255,0.1);
  animation: pageTurn 5s ease forwards;
  pointer-events: none;
}
@keyframes pageTurn {
  0% { transform: rotateY(90deg); opacity: 0; }
  50% { transform: rotateY(0deg); opacity: 1; }
  100% { transform: rotateY(-90deg); opacity: 0; }
}

/* ---------------------- JEU ---------------------- */
#game { display: none; padding: 20px; position: relative; }
#decor {
  position: absolute; top:0; left:0;
  width:100%; height:100%;
  background: url('images/decor-magique.jpg') no-repeat center center;
  background-size: cover;
  z-index: -1;
  display: none;
}
.enigme {
  margin: 20px auto;
  padding: 15px;
  width: 60%;
  background: rgba(0,0,0,0.6);
  border: 2px solid gold;
  border-radius: 10px;
  text-align: left;
  display: none;
}
input { margin-top: 5px; padding: 5px; }

/* ---------------------- BONUS ---------------------- */
.bonus {
  position: absolute;
  width: 50px;
  cursor: pointer;
  display: none;
  transition: transform 0.2s;
}
.bonus:hover { transform: scale(1.2); }
#bonusCounter {
  position: fixed;
  top: 10px; right: 10px;
  background: rgba(0,0,0,0.6);
  padding: 10px;
  border: 2px solid gold;
  border-radius: 10px;
  z-index: 2000;
}

/* ---------------------- POPUPS ---------------------- */
.popup {
  display: none;
  position: fixed;
  top:50%; left:50%;
  transform: translate(-50%,-50%);
  background: rgba(20,20,20,0.95);
  padding: 20px;
  border: 3px solid gold;
  border-radius: 10px;
  z-index: 1000;
  width: 50%;
  text-align: center;
}
.popup button { margin: 10px; padding: 8px 15px; cursor: pointer; }

/* ---------------------- INVENTAIRE ---------------------- */
#inventaire {
  position: fixed; bottom: 0; left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.7);
  border: 2px solid gold;
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
  padding: 10px;
  width: 250px;
  text-align: center;
  cursor: pointer;
  z-index: 2000;
}
#contenuInventaire {
  display: none;
  margin-top: 10px;
  display: flex;
  justify-content: center;
  gap: 10px;
}
#contenuInventaire img { width: 35px; }

/* ---------------------- FIN ---------------------- */
#end {
  display: none;
  height: 100vh;
  padding: 20px;
  color: gold;
}
.victory { animation: victoryAnim 2s forwards; }
.defeat { animation: defeatAnim 2s forwards; }
@keyframes victoryAnim { 0% {transform: scale(0);} 100% {transform: scale(1);}}
@keyframes defeatAnim { 0% {transform: rotate(0deg);} 50% {transform: rotate(10deg);} 100% {transform: rotate(-5deg);}}

table {
  margin: 20px auto;
  border-collapse: collapse;
  width: 80%;
  color: gold;
}
th, td { border: 1px solid gold; padding: 5px; }
</style>
</head>
<body>

<!-- ---------------------- INTRO ---------------------- -->
<div id="intro">
  <div id="introContent">
    <h1>üåë Acad√©mie des Arcanes üåë</h1>
    <p>L‚Äôacad√©mie, sanctuaire de savoir magique, est plong√©e dans l‚Äôombre. Le grimoire ancestral a disparu et la magie est en p√©ril.</p>
    <p>Seuls les plus braves pourront r√©soudre les √©nigmes et restaurer l‚Äô√©quilibre.</p>
    <button onclick="startGame()">Commencer l‚Äôaventure</button>
  </div>
  <div class="grimoirePage"></div>
</div>

<!-- ---------------------- JEU ---------------------- -->
<div id="game">
  <div id="decor"></div>
  <h2>R√©solvez les √©nigmes avant la fin du sablier ‚è≥</h2>
  <div id="timer">Temps restant : 60:00</div>

  <!-- √âNIGMES AVEC BOUTON INDICE -->
  <div class="enigme" id="enigme1" data-indice="La couleur est VIOLET">
    <h3>√ânigme 1 : Potion de Couleurs</h3>
    <p>M√©lange rouge et bleu, quelle couleur appara√Æt ?</p>
    <input type="text" id="rep1">
    <button onclick="verifier(1)">Valider</button>
    <button onclick="demanderIndice(1)">üí° Indice</button>
    <p id="afficheIndice1" style="color:lightblue; display:none;"></p>
  </div>

  <div class="enigme" id="enigme2" data-indice="Le mot magique est SORT">
    <h3>√ânigme 2 : Parchemin cod√©</h3>
    <p>D√©cale chaque lettre de 3 : KRODFR</p>
    <input type="text" id="rep2">
    <button onclick="verifier(2)">Valider</button>
    <button onclick="demanderIndice(2)">üí° Indice</button>
    <p id="afficheIndice2" style="color:lightblue; display:none;"></p>
  </div>

  <!-- BONUS -->
  <img src="images/bonus-fiole.png" class="bonus" id="bonusFiole" style="top:80%; left:15%;" onclick="trouverBonus('fiole')">
  <img src="images/bonus-etoile.png" class="bonus" id="bonusEtoile" style="top:40%; left:70%;" onclick="trouverBonus('etoile')">
  <img src="images/bonus-grimoire.png" class="bonus" id="bonusGrimoire" style="top:60%; left:40%;" onclick="trouverBonus('grimoire')">

  <div id="bonusCounter">Bonus collect√©s : 0</div>

  <!-- INVENTAIRE -->
  <div id="inventaire" onclick="toggleInventaire()">üì¶ Inventaire magique
    <div id="contenuInventaire"></div>
  </div>
</div>

<!-- ---------------------- FIN ---------------------- -->
<div id="end"></div>

<!-- ---------------------- POPUP POUVOIR ---------------------- -->
<div class="popup" id="popupPouvoir">
  <p id="messagePouvoir"></p>
  <button onclick="closePouvoir()">Fermer</button>
</div>

<!-- ---------------------- SONS ---------------------- -->
<audio id="musiqueIntro" src="sons/intro.mp3"></audio>
<audio id="musiqueAmbiance" src="sons/ambiance.mp3" loop></audio>
<audio id="musiqueVictoire" src="sons/victoire.mp3"></audio>
<audio id="musiqueDefaite" src="sons/defaite.mp3"></audio>
<audio id="sonIndice" src="sons/indice.mp3"></audio>
<audio id="sonBonus" src="sons/bonus.mp3"></audio>

<script>
/* ---------------------- VARIABLES ---------------------- */
let tempsRestant = 3600;
let timerInterval;
let inventaire = [];
let bonusCollectes = 0;
let startTime;
let indicesUtilises = {1:false,2:false};

/* ---------------------- INTRO ---------------------- */
function startGame() {
  document.getElementById("intro").style.display = "none";
  document.getElementById("game").style.display = "block";
  startTime = new Date().getTime();

  document.getElementById("musiqueIntro").play();
  setTimeout(()=>{
    document.getElementById("musiqueIntro").pause();
    document.getElementById("musiqueAmbiance").play();
    document.getElementById("decor").style.display="block";
    document.querySelectorAll(".bonus").forEach(b=>b.style.display="block");
    document.getElementById("enigme1").style.display="block";
  },7000);

  timerInterval = setInterval(updateTimer,1000);
}

/* ---------------------- TIMER ---------------------- */
function updateTimer(){
  tempsRestant--;
  let minutes = Math.floor(tempsRestant/60);
  let secondes = tempsRestant%60;
  document.getElementById("timer").innerText = `Temps restant : ${minutes}:${secondes.toString().padStart(2,'0')}`;
  if(tempsRestant<=0){ clearInterval(timerInterval); finPerdue();}
}

/* ---------------------- √âNIGMES ---------------------- */
function verifier(num){
  let reponse = document.getElementById("rep"+num).value.toLowerCase();
  let correcte = (num==1 && reponse==="violet") || (num==2 && reponse==="sort");
  if(correcte){
    document.getElementById("enigme"+num).style.display="none";
    if(num===1) document.getElementById("enigme2").style.display="block";
    if(document.querySelectorAll(".enigme[style*='display: block']").length===0) finGagnee();
  } else alert("Ce n‚Äôest pas encore la bonne r√©ponse...");
}

/* ---------------------- INDICES ---------------------- */
function demanderIndice(num){
  if(indicesUtilises[num]){ alert("Vous avez d√©j√† utilis√© l'indice pour cette √©nigme !"); return; }
  let accepte = confirm("Voulez-vous utiliser l'indice pour cette √©nigme ?");
  if(accepte){
    let indice = document.getElementById("enigme"+num).getAttribute("data-indice");
    document.getElementById("afficheIndice"+num).innerText = indice;
    document.getElementById("afficheIndice"+num).style.display = "block";
    document.getElementById("sonIndice").play();
    indicesUtilises[num]=true;
  }
}

/* ---------------------- BONUS ---------------------- */
function trouverBonus(type){
  document.getElementById("sonBonus").play();
  let message="";
  if(type==="fiole"){ tempsRestant+=120; message="‚è≥ 2 minutes suppl√©mentaires !"; }
  if(type==="etoile"){ message="‚ú® Indice secret disponible."; }
  if(type==="grimoire"){ message="üìñ Grimoire magique trouv√©."; }

  bonusCollectes++;
  document.getElementById("bonusCounter").innerText="Bonus collect√©s : "+bonusCollectes;

  let img=document.createElement("img");
  img.src="images/bonus-"+type+".png";
  document.getElementById("contenuInventaire").appendChild(img);

  document.getElementById("messagePouvoir").innerText=message;
  document.getElementById("popupPouvoir").style.display="block";

  document.getElementById("bonus"+capitalize(type)).style.display="none";
}
function capitalize(s){ return s.charAt(0).toUpperCase()+s.slice(1); }

/* ---------------------- INVENTAIRE ---------------------- */
function toggleInventaire(){
  let c=document.getElementById("contenuInventaire");
  c.style.display = c.style.display==="none"?"flex":"none";
}
function closePouvoir(){ document.getElementById("popupPouvoir").style.display="none"; }

/* ---------------------- FIN ---------------------- */
function finGagnee(){
  clearInterval(timerInterval);
  document.getElementById("game").style.display="none";
  let end=document.getElementById("end");
  end.style.display="block";
  let elapsed=Math.floor((new Date().getTime()-startTime)/1000);
  end.innerHTML="<h1 class='victory'>‚ú® Victoire ! ‚ú®</h1><p>Vous avez sauv√© l'acad√©mie !</p>";
  end.innerHTML+="<h2>Tableau des scores</h2>";
  let table="<table><tr><th>Nom</th><th>R√©sultat</th><th>Temps (s)</th><th>Bonus utilis√©s</th></tr>";
  table+="<tr><td>Joueur</td><td>Gagn√©</td><td>"+elapsed+"</td><td>"+bonusCollectes+"</td></tr></table>";
  end.innerHTML+=table;
  document.getElementById("musiqueAmbiance").pause();
  document.getElementById("musiqueVictoire").play();
}
function finPerdue(){
  clearInterval(timerInterval);
  document.getElementById("game").style.display="none";
  let end=document.getElementById("end");
  end.style.display="block";
  end.innerHTML="<h1 class='defeat'>‚ò† D√©faite... ‚ò†</h1><p>La magie noire a englouti l'acad√©mie.</p>";
  end.innerHTML+="<h2>Tableau des scores</h2>";
  let table="<table><tr><th>Nom</th><th>R√©sultat</th><th>Temps (s)</th><th>Bonus utilis√©s</th></tr>";
  table+="<tr><td>Joueur</td><td>Perdu</td><td>"+(3600-tempsRestant)+"</td><td>"+bonusCollectes+"</td></tr></table>";
  end.innerHTML+=table;
  document.getElementById("musiqueAmbiance").pause();
  document.getElementById("musiqueDefaite").play();
}
</script>
</body>
</html>
